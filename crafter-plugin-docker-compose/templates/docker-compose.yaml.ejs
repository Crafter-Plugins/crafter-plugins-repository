<% 

// var services = [
//   {
//     properties: {
//       name: 'operator'
//     },
//     environment: {
//       port: '3000'
//     }
//   },
//   {
//     properties: {
//       name: 'db',
//       image_name: 'postgres:1.0'
//     },
//     environment: {
//       port: '5032'
//     }
//   }
// ]

// var blueprint_name = 'hello_world'

-%>
version: '3.7'

services:
<% services.forEach(service => { -%>

  <%= service.properties.name -%>:
<% if (service.properties.image_name) { -%>
    image: <%= service.properties.image_name -%>
<% } else { -%>
    build: ./<%= service.properties.name -%>
<% } -%>
<% if (service.environment !== undefined) { -%>
    
    environment:
<% Object.entries(service.environment).forEach(([key, value]) => { -%>
      <%= key %>: <%= value %>
<% }) -%>
<% } else { -%>
<%= %>
<% } -%>
    restart: on-failure
    networks:
      - <%= blueprintName %>
 <% }) -%>

networks:
  <%= blueprintName %>:
